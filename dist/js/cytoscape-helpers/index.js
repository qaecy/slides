"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function w(o,t=!0,s=1e-4,d=.02){let n=0;function a(){o.nodes().forEach((c,r)=>{const e=c.position(),f=Math.sin(performance.now()*s+r)*d,p=Math.cos(performance.now()*s+r)*d;c.position({x:e.x+f,y:e.y+p})}),n=requestAnimationFrame(a)}n=requestAnimationFrame(a);let i=!0;return t&&i&&o.on("mouseover","node",()=>{cancelAnimationFrame(n),i=!1}),n}function g(o,t){if(o.nodes()===void 0)return;let d,n=1/0;return o.nodes().forEach(a=>{n=a.renderedBoundingBox().h;const i=L(t,a.renderedPosition());i<n&&(n=i,d=a)}),d}function L(o,t){const s=t.x-o.x,d=t.y-o.y;return Math.sqrt(s*s+d*d)}class x{constructor(t="node-menu"){this.id=t,this.items=[],this.hideAfter=2e3,this.sticky=!1,this.conditionalDisplay=s=>!0,this.positionDef=(s,d)=>{const a=s.renderedBoundingBox().h/2,i=Math.sin(Math.PI/4)*a;d.bottom=`${i}px`,d.left=`${i}px`}}}function y(o,t){function s(){o.nodes().forEach(d=>{const n=d.renderedPosition();let a=document.getElementById(`box-${d.id()}`);a||(a=document.createElement("div"),a.id=`box-${d.id()}`,a.style.position="absolute",t.appendChild(a)),a.style.left=`${n.x}px`,a.style.top=`${n.y}px`})}s(),o.on("position","node",s),o.on("pan zoom",s),window.addEventListener("resize",s)}function v(o,t,s){y(o,t);let d=!1;function n(r){const e=document.createElement("div");e.id=`${s.id}-${r.id()}`,e.classList.add("node-menu"),e.classList.add(s.id),e.addEventListener("mouseover",()=>d=!0),e.addEventListener("mouseout",()=>d=!1),s.items.forEach(p=>{const l=document.createElement("div");if(l.style.position="relative",e.appendChild(l),l.innerText=p.icon,l.addEventListener("click",h=>{h.preventDefault(),h.stopImmediatePropagation(),p.click(r)}),l.addEventListener("touchstart",h=>{h.preventDefault(),h.stopImmediatePropagation(),p.click(r)}),l.classList.add("entry"),l.classList.add("material-icons"),p.tooltip!==void 0){const h=document.createElement("div");h.innerText=p.tooltip;const u=h.style;u.position="absolute",u.display="none",u.bottom="100%",u.left="50%",u.transform="translate(-50%)",h.classList.add("tooltip"),l.appendChild(h),l.addEventListener("mouseover",()=>u.display="block"),l.addEventListener("mouseleave",()=>u.display="none")}});const f=document.getElementById(`box-${r.id()}`);return s.positionDef(r,e.style),f&&f.appendChild(e),e}function a(r){let e=document.getElementById(`${s.id}-${r.id()}`);e||(e=n(r)),e.style.display="flex"}function i(r){const e=document.getElementById(`${s.id}-${r.id()}`);e&&(e.style.display="none")}function c(){o.nodes().forEach(r=>{const e=document.getElementById(`${s.id}-${r.id()}`);e&&s.positionDef(r,e.style)})}s.sticky?o.nodes().forEach(r=>{s.conditionalDisplay(r)&&a(r)}):o.on("mouseover","node",r=>{if(!s.conditionalDisplay(r.target))return;a(r.target);const e=setInterval(()=>{d||(i(r.target),clearInterval(e))},s.hideAfter)}),o.on("pan zoom",c),window.addEventListener("resize",c)}const B={props:{displayOnlyOnHover:!0},boxLabels:{displayOnlyOnHover:!1}};function E(o,t,s=B){y(o,t);function d(){o.nodes().forEach(n=>{const a=n.renderedBoundingBox().h,i=document.getElementById(`box-${n.id()}`);if(!i)return;const c=n.data().boxLabels;if(c!==void 0){let e=document.getElementById(`labels-box-${n.id()}`);e?e.style.bottom=`${a/2-10}px`:(e=document.createElement("div"),e.id=`labels-box-${n.id()}`,e.className="box-label",e.style.bottom=`${a/2-10}px`,s.boxLabels.displayOnlyOnHover&&(e.style.display="none"),i.appendChild(e),c.forEach((f,p)=>{if(!e)return;const l=document.createElement("div");l.id=`labels-box-${n.id()}-${p}`,l.className="entry",l.innerHTML=f,e.appendChild(l)}))}const r=n.data().properties;if(r!==void 0){let e=document.getElementById(`props-box-${n.id()}`);e?e.style.top=`${a/2-10}px`:(e=document.createElement("div"),e.id=`props-box-${n.id()}`,e.style.right="0px",e.className="property",e.style.top=`${a/2-10}px`,s.props.displayOnlyOnHover&&(e.style.display="none"),i.appendChild(e),Object.keys(r).forEach((f,p)=>{if(!e)return;const l=document.createElement("div");l.id=`props-box-${n.id()}-${p}`,l.className="entry",l.innerHTML=`<span class="key">${f}</span><span class="value">${r[f]}</span>`,e.appendChild(l)}))}})}d(),o.on("zoom",d),o.on("mouseover","node",n=>{const a=n.target;if(s.props.displayOnlyOnHover){const i=document.getElementById(`props-box-${a.id()}`);i&&(i.style.display="flex")}if(s.boxLabels.displayOnlyOnHover){const i=document.getElementById(`labels-box-${a.id()}`);i&&(i.style.display="flex")}}),o.on("mouseout","node",n=>{const a=n.target;if(s.props.displayOnlyOnHover){const i=document.getElementById(`props-box-${a.id()}`);i&&(i.style.display="none")}if(s.boxLabels.displayOnlyOnHover){const i=document.getElementById(`labels-box-${a.id()}`);i&&(i.style.display="none")}})}class C{constructor(){this.groupByField="category",this.groupFor={type:"folder"},this.layoutOptions={name:"cose"},this.collapseThreshold=1}}function N(o,t){const s=Object.keys(t.groupFor)[0],d=Object.values(t.groupFor)[0],n=new x("expand-menu");n.items=[{icon:"add",click:e=>c(e)}],n.sticky=!0,n.positionDef=(e,f)=>{const l=e.renderedBoundingBox().h/2,h=Math.sin(Math.PI/4)*l-8;f.top=`${h}px`,f.right=`${h}px`},n.conditionalDisplay=e=>e.data("canExpand");const a=[],i=[];o.nodes().filter(e=>e.data(s)===d).forEach(e=>{a.push(e),i.push(e.id())}),a.forEach(e=>{const f=e.neighborhood().filter(u=>u.isNode()&&!i.includes(u.id())),p=new Set,l={};f.forEach(u=>{const m=u.data(t.groupByField);m!==void 0&&(p.add(m),Object.keys(l).includes(m)||(l[m]=[]),l[m].push(u),u.hide())});const h=[];p.forEach(u=>{if(l[u].length<=t.collapseThreshold){l[u].forEach($=>$.show());return}const m=`${e.id()}-${u}`;h.push({group:"nodes",data:{id:m,label:u,collapsedNodes:l[u],canExpand:!0,boxLabels:[l[u].length]}},{group:"edges",data:{source:e.id(),target:m}})}),o.add(h)});function c(e){const f=e.data();if(!Object.keys(f).includes("collapsedNodes"))return;f.collapsedNodes.forEach(l=>{l.show()}),e.hide();const p=document.getElementById(`box-${e.id()}`);p&&Array.from(p.children).forEach(l=>l.style.display="none"),o.layout(t.layoutOptions).run()}o.layout(t.layoutOptions).run();const r=o.container();r&&(v(o,r,n),E(o,r))}const b={backgroundColor:"#fff",edgeColor:"#0d5be9",edgeFontSize:"5rem",edgeWidth:"3rem",nodeColor:"#03337a",nodeOpacity:"0.9",font:"Poppins",directed:!0,labelSelector:"label",showNodeLabels:!0,showEdgeLabels:!0,hoverBorderColor:"#0d5be9"},O=(o=b)=>[{selector:"node",style:{label:t=>t.data(o.labelSelector)&&o.showNodeLabels?t.data(o.labelSelector):"","text-valign":"center","font-family":o.font,"font-size":"10rem",opacity:o.nodeOpacity,color:"white","text-outline-color":t=>t.data("color")?t.data("color"):o.nodeColor,"text-outline-width":1,"background-color":t=>t.data("color")?t.data("color"):o.nodeColor,width:t=>t.data("size")?t.data("size"):"20",height:t=>t.data("size")?t.data("size"):"20"}},{selector:"edge",style:{label:t=>t.data(o.labelSelector)&&o.showEdgeLabels?t.data(o.labelSelector):"","text-valign":"center","font-family":o.font,"font-size":o.edgeFontSize,color:o.edgeColor,"target-arrow-color":o.edgeColor,"curve-style":"bezier","target-arrow-shape":o.directed?"triangle":"none","line-color":o.edgeColor,width:t=>t.data("width")?t.data("width"):o.edgeWidth,"text-rotation":"autorotate","text-background-opacity":1,"text-background-color":o.backgroundColor,"text-background-padding":4}},{selector:".triple",style:{"background-color":"white","border-color":t=>t.data("color")?t.data("color"):o.nodeColor}},{selector:".literal",style:{shape:"rectangle",width:"label",height:"label",label:t=>t.data(o.labelSelector)?t.data(o.labelSelector):"",padding:"2rem","border-color":"black","border-width":.3,"background-color":"white","text-outline-width":0,color:"black"}},{selector:".loading",style:{"pie-size":"100%","pie-1-background-color":b.nodeColor,"pie-1-background-size":t=>`${t.data("pct")}%`,"pie-2-background-color":b.edgeColor,"pie-2-background-size":t=>`${100-parseInt(t.data("pct"))}%`,label:t=>t.data("pct")!==void 0&&t.data("pct")!==100?`${parseInt(t.data("pct"))}%`:"","font-size":"5rem"}},{selector:".dropzone",style:{"border-color":o.hoverBorderColor,"border-width":6,"border-opacity":1}}],S={name:"cose",padding:100};function z(o){o.on("dragfree","node",t),o.on("viewport",t);function t(){const s=o.json(),d=[];s.elements.nodes.forEach(n=>{const a={};a.data=n.data,a.position={x:Math.round(n.position.x),y:Math.round(n.position.y)},n.classes&&(a.classes=n.classes),d.push(a)}),console.log(d)}}function k(o){o.on("dragfree","node",t),o.on("viewport",t);function t(){const s=o.json(),d=[],n=[];s.elements.nodes.forEach(a=>{const i={};i.data=a.data,a.classes&&(i.classes=a.classes),d.push(i)}),s.elements.edges.forEach(a=>{const i={};i.data=a.data,a.classes&&(i.classes=a.classes),n.push(i)}),console.log({nodes:d,edges:n})}}function I(o){function t(d,n=""){return new Promise(a=>{d&&(d.isFile?d.file(i=>{i.filepath=n+i.name,s.push(i),a(i)}):d.isDirectory&&d.createReader().readEntries(c=>{const r=[];for(const e of c)r.push(t(e,n+d.name+"/"));a(Promise.all(r))}))})}const s=[];return new Promise(d=>{const n=[];for(const a of o)n.push(t(a.webkitGetAsEntry()));Promise.all(n).then(()=>{d(s)})})}function M(o,t=s=>!0){let s;d(o);function d(n){var a,i;(a=n.container())==null||a.addEventListener("dragover",async c=>{c.preventDefault(),c.stopPropagation();const r={x:c.offsetX,y:c.offsetY},e=g(n,r);if(e===void 0&&s!==void 0)s.removeClass("dropzone"),n.emit("nodeFileDropHoverEnd",{node:s}),s.emit("filesHoverEnd");else if(s!==e&&e!==void 0){if(!t(e))return;e.addClass("dropzone"),n.emit("nodeFileDropHoverStart",{node:e}),e.emit("filesHoverStart")}s=e}),(i=n.container())==null||i.addEventListener("drop",async c=>{var f;c.preventDefault(),c.stopPropagation();const r={x:c.offsetX,y:c.offsetY},e=g(n,r);if(e!==void 0){if(!t(e))return;e.removeClass("dropzone");const p=await I((f=c.dataTransfer)==null?void 0:f.items);p!==void 0&&e.emit("filesDropped",p),n.emit("nodeFileDropDropped",{node:e,files:p})}})}}function H(o){o.on("mouseover","node",t=>{const s=t.target;s.style("label",s.data("label"))}),o.on("mouseout","node",t=>{t.target.style("label","")})}exports.CollapseSettings=C;exports.NodeMenuSettings=x;exports.animateGraph=w;exports.appendHTMLLabels=E;exports.appendHostContainers=y;exports.appendNodeFileDrop=M;exports.appendNodeMenu=v;exports.buildStyles=O;exports.closestNode=g;exports.collapseGraph=N;exports.defaultSettings=b;exports.layoutOptions=S;exports.logNodePositions=z;exports.logNodesEdges=k;exports.showNodeLabelOnHover=H;
