"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function M(i,e=!0,t=1e-4,n=.02){let o=0;function s(){i.nodes().forEach((u,d)=>{const a=u.position(),p=Math.sin(performance.now()*t+d)*n,l=Math.cos(performance.now()*t+d)*n;u.position({x:a.x+p,y:a.y+l})}),o=requestAnimationFrame(s)}o=requestAnimationFrame(s);let r=!0;return e&&r&&i.on("mouseover","node",()=>{cancelAnimationFrame(o),r=!1}),o}class ${constructor(e="node-menu"){this.id=e,this.items=[],this.hideAfter=2e3,this.sticky=!1,this.conditionalDisplay=t=>!0,this.positionDef=(t,n)=>{const s=t.renderedBoundingBox().h/2,r=Math.sin(Math.PI/4)*s;n.bottom=`${r}px`,n.left=`${r}px`}}}function b(i,e){function t(){i.nodes().forEach(n=>{const o=n.renderedPosition();let s=document.getElementById(`box-${n.id()}`);s||(s=document.createElement("div"),s.id=`box-${n.id()}`,s.style.position="absolute",e.appendChild(s)),s.style.left=`${o.x}px`,s.style.top=`${o.y}px`})}t(),i.on("position","node",t),i.on("pan zoom",t),window.addEventListener("resize",t)}function O(i,e,t){b(i,e);let n=!1;function o(d){const a=document.createElement("div");a.id=`${t.id}-${d.id()}`,a.classList.add("node-menu"),a.classList.add(t.id),a.addEventListener("mouseover",()=>n=!0),a.addEventListener("mouseout",()=>n=!1),t.items.forEach(l=>{const c=document.createElement("div");a.appendChild(c),c.innerText=l.icon,c.addEventListener("click",m=>{m.preventDefault(),m.stopImmediatePropagation(),l.click(d)}),c.classList.add("entry"),c.classList.add("material-icons")});const p=document.getElementById(`box-${d.id()}`);return t.positionDef(d,a.style),p&&p.appendChild(a),a}function s(d){let a=document.getElementById(`${t.id}-${d.id()}`);a||(a=o(d)),a.style.display="flex"}function r(d){const a=document.getElementById(`${t.id}-${d.id()}`);a&&(a.style.display="none")}function u(){i.nodes().forEach(d=>{const a=document.getElementById(`${t.id}-${d.id()}`);a&&t.positionDef(d,a.style)})}t.sticky?i.nodes().forEach(d=>{t.conditionalDisplay(d)&&s(d)}):i.on("mouseover","node",d=>{if(!t.conditionalDisplay(d.target))return;s(d.target);const a=setInterval(()=>{n||(r(d.target),clearInterval(a))},t.hideAfter)}),i.on("pan zoom",u),window.addEventListener("resize",u)}const B={props:{displayOnlyOnHover:!0},boxLabels:{displayOnlyOnHover:!1}};function w(i,e,t=B){b(i,e);function n(){i.nodes().forEach(o=>{const s=o.renderedBoundingBox().h,r=document.getElementById(`box-${o.id()}`);if(!r)return;const u=o.data().boxLabels;if(u!==void 0){let a=document.getElementById(`labels-box-${o.id()}`);a?a.style.bottom=`${s/2-10}px`:(a=document.createElement("div"),a.id=`labels-box-${o.id()}`,a.className="box-label",a.style.bottom=`${s/2-10}px`,t.boxLabels.displayOnlyOnHover&&(a.style.display="none"),r.appendChild(a),u.forEach((p,l)=>{if(!a)return;const c=document.createElement("div");c.id=`labels-box-${o.id()}-${l}`,c.className="entry",c.innerHTML=p,a.appendChild(c)}))}const d=o.data().properties;if(d!==void 0){let a=document.getElementById(`props-box-${o.id()}`);a?a.style.top=`${s/2-10}px`:(a=document.createElement("div"),a.id=`props-box-${o.id()}`,a.style.right="0px",a.className="property",a.style.top=`${s/2-10}px`,t.props.displayOnlyOnHover&&(a.style.display="none"),r.appendChild(a),Object.keys(d).forEach((p,l)=>{if(!a)return;const c=document.createElement("div");c.id=`props-box-${o.id()}-${l}`,c.className="entry",c.innerHTML=`<span class="key">${p}</span><span class="value">${d[p]}</span>`,a.appendChild(c)}))}})}n(),i.on("zoom",n),i.on("mouseover","node",o=>{const s=o.target;if(t.props.displayOnlyOnHover){const r=document.getElementById(`props-box-${s.id()}`);r&&(r.style.display="flex")}if(t.boxLabels.displayOnlyOnHover){const r=document.getElementById(`labels-box-${s.id()}`);r&&(r.style.display="flex")}}),i.on("mouseout","node",o=>{const s=o.target;if(t.props.displayOnlyOnHover){const r=document.getElementById(`props-box-${s.id()}`);r&&(r.style.display="none")}if(t.boxLabels.displayOnlyOnHover){const r=document.getElementById(`labels-box-${s.id()}`);r&&(r.style.display="none")}})}function C(i,e,t){const n=Object.keys(t)[0],o=Object.values(t)[0],s=new $("expand-menu");s.items=[{icon:"add",click:l=>d(l)}],s.sticky=!0,s.positionDef=(l,c)=>{const f=l.renderedBoundingBox().h/2,y=Math.sin(Math.PI/4)*f-8;c.top=`${y}px`,c.right=`${y}px`},s.conditionalDisplay=l=>l.data("canExpand");const r=[],u=[];i.nodes().filter(l=>l.data(n)===o).forEach(l=>{r.push(l),u.push(l.id())}),r.forEach(l=>{const c=l.neighborhood(),m=new Set,f={};c.filter(h=>!u.includes(h.id())).forEach(h=>{const g=h.data(e);g!==void 0&&(m.add(g),Object.keys(f).includes(g)||(f[g]=[]),f[g].push(h),h.hide())});const y=[];m.forEach(h=>{const g=`${l.id()}-${h}`;y.push({group:"nodes",data:{id:g,label:h,collapsedNodes:f[h],canExpand:!0,boxLabels:[f[h].length]}},{group:"edges",data:{source:l.id(),target:g}})}),i.add(y)});function d(l){const c=l.data();if(!Object.keys(c).includes("collapsedNodes"))return;c.collapsedNodes.forEach(f=>{f.show()}),l.hide();const m=document.getElementById(`box-${l.id()}`);m&&Array.from(m.children).forEach(f=>f.style.display="none"),a()}function a(){i.layout({name:"cose"}).run()}a();const p=document.getElementById("cy");p&&(O(i,p,s),w(i,p))}var L=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N={},x={};Object.defineProperty(x,"__esModule",{value:!0});function I(i){return i}x.asTypedEventEmitter=I;var E={},k=L&&L.__spreadArrays||function(){for(var i=0,e=0,t=arguments.length;e<t;e++)i+=arguments[e].length;for(var n=Array(i),o=0,e=0;e<t;e++)for(var s=arguments[e],r=0,u=s.length;r<u;r++,o++)n[o]=s[r];return n};Object.defineProperty(E,"__esModule",{value:!0});var z=function(){function i(){var e=this;this.events={},this.maxListeners=1/0,this.emit=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(e.events[t]){for(var s=e.events[t].length,r=Array.from(e.events[t]),u=0,d=r;u<d.length;u++){var a=d[u];a.apply(void 0,n)}return!!s}return!1},this.on=function(t,n){return e.addListener(t,n),e},this.once=function(t,n){var o=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];n.apply(void 0,s),e.removeListener(t,o)};return e.addListener(t,o),e},this.addListener=function(t,n){return t in e.events?e.events[t].push(n):e.events[t]=[n],e.maxListeners!==1/0&&e.maxListeners<=e.events[t].length&&console.warn('Maximum event listeners for "'+t+'" event!'),e},this.removeListener=function(t,n){if(t in e.events){var o=e.events[t].indexOf(n);o!==-1&&e.events[t].splice(o,1)}return e},this.hasListeners=function(t){return e.events[t]&&!!e.events[t].length},this.prependListener=function(t,n){return t in e.events?e.events[t].unshift(n):e.events[t]=[n],e},this.prependOnceListener=function(t,n){var o=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];n.apply(void 0,s),e.removeListener(t,o)};return e.prependListener(t,o),e},this.off=function(t,n){return e.removeListener(t,n)},this.removeAllListeners=function(t){return delete e.events[t],e},this.setMaxListeners=function(t){return e.maxListeners=t,e},this.getMaxListeners=function(){return e.maxListeners},this.listeners=function(t){return k(e.events[t])},this.rawListeners=function(t){return e.events[t]},this.eventNames=function(){return Object.keys(e.events)},this.listenerCount=function(t){return e.events[t]&&e.events[t].length||0}}return i}();E.EventEmitter=z;(function(i){function e(t){for(var n in t)i.hasOwnProperty(n)||(i[n]=t[n])}Object.defineProperty(i,"__esModule",{value:!0}),e(x),e(E)})(N);class H{constructor(e){this._cy=e,this.events=new N.EventEmitter,this._initEventListeners()}_initEventListeners(){var e,t;(e=this._cy.container())==null||e.addEventListener("dragover",n=>{n.preventDefault(),n.stopPropagation();const o=this._getClosestNode(n);o===void 0&&this._lastHoveredNode!==void 0?this.events.emit("fileOverNodeEnd",this._lastHoveredNode):this._lastHoveredNode!==o&&o!==void 0&&this.events.emit("fileOverNodeStart",o),this._lastHoveredNode=o}),(t=this._cy.container())==null||t.addEventListener("drop",n=>{var s;n.preventDefault(),n.stopPropagation();const o=this._getClosestNode(n);if(o!==void 0){const r=(s=n.dataTransfer)==null?void 0:s.files;r!==void 0&&this.events.emit("filesDroppedOnNode",o,r)}})}_getClosestNode(e,t=20){var u,d;if(((u=this._cy)==null?void 0:u.nodes())===void 0)return;const o={x:e.offsetX,y:e.offsetY};let s,r=t;return(d=this._cy)==null||d.nodes().forEach(a=>{const p=this._distance(o,a.renderedPosition());p<r&&(r=p,s=a)}),s}_distance(e,t){const n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}}const v={backgroundColor:"#fff",edgeColor:"#0d5be9",edgeFontSize:"5rem",edgeWidth:"3rem",nodeColor:"#03337a",nodeOpacity:"0.9",font:"Poppins",directed:!0},S=(i=v)=>[{selector:"node",style:{label:e=>e.data("label")?e.data("label"):"","text-valign":"center","font-family":i.font,"font-size":"10rem",opacity:i.nodeOpacity,color:"white","text-outline-color":e=>e.data("color")?e.data("color"):i.nodeColor,"text-outline-width":1,"background-color":e=>e.data("color")?e.data("color"):i.nodeColor,width:e=>e.data("size")?e.data("size"):"",height:e=>e.data("size")?e.data("size"):""}},{selector:"edge",style:{label:e=>e.data("label")?e.data("label"):"","text-valign":"center","font-family":i.font,"font-size":i.edgeFontSize,color:i.edgeColor,"target-arrow-color":i.edgeColor,"curve-style":"bezier","target-arrow-shape":i.directed?"triangle":"none","line-color":i.edgeColor,width:e=>e.data("width")?e.data("width"):i.edgeWidth,"text-rotation":"autorotate","text-background-opacity":1,"text-background-color":i.backgroundColor,"text-background-padding":4}},{selector:".triple",style:{"background-color":"white","border-color":e=>e.data("color")?e.data("color"):i.nodeColor}},{selector:".literal",style:{shape:"rectangle",width:"label",height:"label",label:e=>e.data("label")?e.data("label"):"",padding:"2rem","border-color":"black","border-width":.3,"background-color":"white","text-outline-width":0,color:"black"}},{selector:".loading",style:{"pie-size":"100%","pie-1-background-color":v.nodeColor,"pie-1-background-size":e=>`${e.data("pct")}%`,"pie-2-background-color":v.edgeColor,"pie-2-background-size":e=>`${100-parseInt(e.data("pct"))}%`,label:e=>`${e.data("pct")}%`,"font-size":"5rem"}}],P={name:"grid",padding:100};function _(i){i.on("dragfree","node",e),i.on("viewport",e);function e(){const t=i.json(),n=[];t.elements.nodes.forEach(o=>{const s={};s.data=o.data,s.position={x:Math.round(o.position.x),y:Math.round(o.position.y)},o.classes&&(s.classes=o.classes),n.push(s)}),console.log(n)}}function D(i){i.on("dragfree","node",e),i.on("viewport",e);function e(){const t=i.json(),n=[],o=[];t.elements.nodes.forEach(s=>{const r={};r.data=s.data,s.classes&&(r.classes=s.classes),n.push(r)}),t.elements.edges.forEach(s=>{const r={};r.data=s.data,s.classes&&(r.classes=s.classes),o.push(r)}),console.log({nodes:n,edges:o})}}exports.FileDropHandler=H;exports.NodeMenuSettings=$;exports.animateGraph=M;exports.appendHTMLLabels=w;exports.appendHostContainers=b;exports.appendNodeMenu=O;exports.buildStyles=S;exports.collapseGraph=C;exports.defaultSettings=v;exports.layout=P;exports.logNodePositions=_;exports.logNodesEdges=D;
